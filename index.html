<!DOCTYPE html><html class="default" lang="en" data-base="."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>proxydi</title><meta name="description" content="Documentation for proxydi"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><link rel="stylesheet" href="assets/custom.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">proxydi</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>proxydi</h1></div><div class="tsd-panel tsd-typography"><a id="proxydi" class="tsd-anchor"></a><h1 class="tsd-anchor-link">ProxyDi<a href="#proxydi" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p><a href="https://coveralls.io/github/proxy-di/proxydi"><img src="https://coveralls.io/repos/github/proxy-di/proxydi/badge.png" alt="Coverage Status"></a></p>
<p>A typed hierarchical DI container that resolves circular dependencies via Proxy.</p>
<img src="https://github.com/proxy-di/proxydi/blob/main/assets/ProxyDiLogo.png?raw=true" width="196">
<p>Core features:</p>
<ul>
<li>Uses Stage 3 decorators, supported in TypeScript 5.x (<a href="https://github.com/proxy-di/node-ts-examples">examples repository</a>) and Babel via babel-plugin-proposal-decorators (<a href="https://github.com/proxy-di/node-babel-examples">examples repository</a>)</li>
<li>Automatically resolves circular dependencies with no persormance impact</li>
<li>Resolves dependencies in the context of a particular container</li>
<li>Matches dependencies by unique identifiers or automatically using class names and property names</li>
<li>Currently under active development, the API may change until version 0.1.0</li>
</ul>
<a id="quick-start" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Quick start<a href="#quick-start" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><blockquote>
<p>If you are using React, you should use the React wrapper for ProxyDi instead of this library directly: <a href="https://github.com/proxy-di/proxydi-react">@proxydi/react</a></p>
</blockquote>
<p>Install the <code>proxydi</code> package in your JavaScript or TypeScript project:</p>
<pre><code class="shell"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">i</span><span class="hl-1"> </span><span class="hl-2">proxydi</span>
</code><button type="button">Copy</button></pre>

<a id="configure-typescript" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Configure TypeScript<a href="#configure-typescript" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>If you are using TypeScript, ensure that <code>experimentalDecorators</code> is set to <code>false</code> in your <code>tsconfig.json</code>. This enables support for Stage 3 decorators:</p>
<pre><code class="jsonc"><span class="hl-3">// tsconfig.json</span><br/><span class="hl-1">{</span><br/><span class="hl-1">    </span><span class="hl-4">&quot;compilerOptions&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">        </span><span class="hl-3">// ...</span><br/><span class="hl-1">        </span><span class="hl-4">&quot;experimentalDecorators&quot;</span><span class="hl-1">: </span><span class="hl-5">false</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">&quot;strictPropertyInitialization&quot;</span><span class="hl-1">: </span><span class="hl-5">false</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-3">//...</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>Changing <code>strictPropertyInitialization</code> is not necessary, but if you leave it at the default value, you will need to slightly modify the examples. More about this later.</p>
<a id="configure-babel" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Configure Babel<a href="#configure-babel" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>For Babel projects, ensure that @babel/plugin-proposal-decorators is configured exactly as follows:</p>
<pre><code class="jsonc"><span class="hl-3">// .babelrc</span><br/><span class="hl-1">{</span><br/><span class="hl-1">    </span><span class="hl-3">// ...</span><br/><span class="hl-1">    </span><span class="hl-4">&quot;plugins&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">        </span><span class="hl-3">// other plugins</span><br/><span class="hl-1">        [</span><span class="hl-2">&quot;@babel/plugin-proposal-decorators&quot;</span><span class="hl-1">, { </span><span class="hl-4">&quot;version&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;2023-11&quot;</span><span class="hl-1"> }],</span><br/><span class="hl-1">    ],</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="usage" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Usage<a href="#usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><blockquote>
<p>We will use TypeScript for all examples, because it is easier to remove typing than add it</p>
</blockquote>
<p>The process of using ProxyDi consists of 3 stages:</p>
<ol>
<li>Use the <a href="https://proxy-di.github.io/proxydi/functions/inject.html">@inject()</a> decorator to define the dependencies to be resolved by the ProxyDi container. In this example, we define an interface for characters and ask ProxyDi to resolve the <code>Role</code> dependency for actors.</li>
</ol>
<pre><code class="typescript"><span class="hl-5">interface</span><span class="hl-1"> </span><span class="hl-6">Character</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">greet</span><span class="hl-1">(): </span><span class="hl-6">string</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">class</span><span class="hl-1"> </span><span class="hl-6">Actor</span><span class="hl-1"> {</span><br/><span class="hl-1">    @</span><span class="hl-0">inject</span><span class="hl-1">(</span><span class="hl-2">&#39;Role&#39;</span><span class="hl-1">) </span><span class="hl-7">role</span><span class="hl-1">: </span><span class="hl-6">Character</span><span class="hl-1">;</span><br/><br/><span class="hl-1">    </span><span class="hl-0">play</span><span class="hl-1"> = () </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-7">role</span><span class="hl-1">.</span><span class="hl-0">greet</span><span class="hl-1">();</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<ol start="2">
<li>Next, create the <a href="https://proxy-di.github.io/proxydi/classes/ProxyDiContainer.html">ProxyDiContainer</a>
and fill it with dependencies using <a href="https://proxy-di.github.io/proxydi/classes/ProxyDiContainer.html#register">register()</a> metod. For example, let's define an agent 007 role and prepare our first container:</li>
</ol>
<pre><code class="typescript"><span class="hl-5">class</span><span class="hl-1"> </span><span class="hl-6">Agent007</span><span class="hl-1"> </span><span class="hl-5">implements</span><span class="hl-1"> </span><span class="hl-6">Character</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">greet</span><span class="hl-1"> = () </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-2">&#39;Bond... James Bond&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">container</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">ProxyDiContainer</span><span class="hl-1">();</span><br/><span class="hl-7">container</span><span class="hl-1">.</span><span class="hl-0">register</span><span class="hl-1">(</span><span class="hl-7">Agent007</span><span class="hl-1">, </span><span class="hl-2">&#39;Role&#39;</span><span class="hl-1">);</span><br/><span class="hl-7">container</span><span class="hl-1">.</span><span class="hl-0">register</span><span class="hl-1">(</span><span class="hl-7">Actor</span><span class="hl-1">, </span><span class="hl-2">&#39;Actor&#39;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<ol start="3">
<li>At the last stage, take dependencies from the ProxyDi container by <a href="https://proxy-di.github.io/proxydi/classes/ProxyDiContainer.html#resolve">resolve()</a> method and just use them. To continue our example, let our actor play its role:</li>
</ol>
<pre><code class="typescript"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">actor</span><span class="hl-1"> = </span><span class="hl-7">container</span><span class="hl-1">.</span><span class="hl-0">resolve</span><span class="hl-1">&lt;</span><span class="hl-6">Actor</span><span class="hl-1">&gt;(</span><span class="hl-2">&#39;Actor&#39;</span><span class="hl-1">);</span><br/><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-7">actor</span><span class="hl-1">.</span><span class="hl-0">play</span><span class="hl-1">());</span>
</code><button type="button">Copy</button></pre>

<p>And the result is:</p>
<pre><code class="shell"><span class="hl-1">&gt; Bond... James Bond</span>
</code><button type="button">Copy</button></pre>

<a id="the-reason" class="tsd-anchor"></a><h2 class="tsd-anchor-link">The Reason<a href="#the-reason" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>To illustrate why we should use a container for this simple purpose, let's create a container for another character and ask the actor to play the new role:</p>
<pre><code class="typescript"><span class="hl-5">class</span><span class="hl-1"> </span><span class="hl-6">M</span><span class="hl-1"> </span><span class="hl-5">implements</span><span class="hl-1"> </span><span class="hl-6">Character</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">greet</span><span class="hl-1"> = () </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-2">&#39;007, I have a new mission for you&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">container</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">ProxyDiContainer</span><span class="hl-1">();</span><br/><span class="hl-7">container</span><span class="hl-1">.</span><span class="hl-0">register</span><span class="hl-1">(</span><span class="hl-8">M</span><span class="hl-1">, </span><span class="hl-2">&#39;Role&#39;</span><span class="hl-1">);</span><br/><span class="hl-7">container</span><span class="hl-1">.</span><span class="hl-0">register</span><span class="hl-1">(</span><span class="hl-7">Actor</span><span class="hl-1">, </span><span class="hl-2">&#39;Actor&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">actor</span><span class="hl-1"> = </span><span class="hl-7">container</span><span class="hl-1">.</span><span class="hl-0">resolve</span><span class="hl-1">&lt;</span><span class="hl-6">Actor</span><span class="hl-1">&gt;(</span><span class="hl-2">&#39;Actor&#39;</span><span class="hl-1">);</span><br/><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-7">actor</span><span class="hl-1">.</span><span class="hl-0">play</span><span class="hl-1">());</span>
</code><button type="button">Copy</button></pre>

<pre><code class="shell"><span class="hl-1">&gt; 007, I have a new mission </span><span class="hl-9">for</span><span class="hl-1"> you</span>
</code><button type="button">Copy</button></pre>

<p>In this example, we changed the behavior of the actor by changing the role dependency in the ProxyDi container. This is exactly the goal of the <a href="https://en.wikipedia.org/wiki/Dependency_inversion_principle">Dependency inversion principle</a> in SOLID approach to design software. Continuing our metaphor, the actor can play any role, but he is not the one who decides which role he will play. This is a film director's decision, and here we just cosplay him by setting up our containers.</p>
<blockquote>
<p>So, ProxyDi is just a tool to link dependencies, allowing them to freely communicate with each other without worrying about which specific dependency they're dealing with. And nothing more.</p>
</blockquote>
<a id="circular-dependencies" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Circular dependencies<a href="#circular-dependencies" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>There are several rough edges in traditional DI container implementations that ProxyDi addresses. The first of these is circular dependencies.</p>
<p>Let's illustrate this with a movie set metaphor. During filming, the actor and director work together in a continuous feedback loop:</p>
<pre><code class="typescript"><span class="hl-5">class</span><span class="hl-1"> </span><span class="hl-6">Director</span><span class="hl-1"> {</span><br/><span class="hl-1">    @</span><span class="hl-0">inject</span><span class="hl-1">(</span><span class="hl-2">&#39;Actor&#39;</span><span class="hl-1">) </span><span class="hl-5">private</span><span class="hl-1"> </span><span class="hl-7">actor</span><span class="hl-1">: </span><span class="hl-6">Actor</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-5">private</span><span class="hl-1"> </span><span class="hl-7">passionLevel</span><span class="hl-1"> = </span><span class="hl-10">1</span><span class="hl-1">;</span><br/><br/><span class="hl-1">    </span><span class="hl-0">direct</span><span class="hl-1">(</span><span class="hl-7">line</span><span class="hl-1">: </span><span class="hl-6">string</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-9">return</span><span class="hl-1"> </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-7">actor</span><span class="hl-1">.</span><span class="hl-0">perform</span><span class="hl-1">(</span><span class="hl-7">line</span><span class="hl-1">, </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-7">passionLevel</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">class</span><span class="hl-1"> </span><span class="hl-6">Actor</span><span class="hl-1"> {</span><br/><span class="hl-1">    @</span><span class="hl-0">inject</span><span class="hl-1">(</span><span class="hl-2">&#39;Role&#39;</span><span class="hl-1">) </span><span class="hl-5">private</span><span class="hl-1"> </span><span class="hl-7">role</span><span class="hl-1">: </span><span class="hl-6">Character</span><span class="hl-1">;</span><br/><span class="hl-1">    @</span><span class="hl-0">inject</span><span class="hl-1">(</span><span class="hl-2">&#39;Director&#39;</span><span class="hl-1">) </span><span class="hl-5">private</span><span class="hl-1"> </span><span class="hl-7">director</span><span class="hl-1">: </span><span class="hl-6">Director</span><span class="hl-1">;</span><br/><br/><span class="hl-1">    </span><span class="hl-0">play</span><span class="hl-1">() {</span><br/><span class="hl-1">        </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">line</span><span class="hl-1"> = </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-7">role</span><span class="hl-1">.</span><span class="hl-0">greet</span><span class="hl-1">();</span><br/><span class="hl-1">        </span><span class="hl-3">// Here, the actor asks the director how to perform the line.</span><br/><span class="hl-1">        </span><span class="hl-9">return</span><span class="hl-1"> </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-7">director</span><span class="hl-1">.</span><span class="hl-0">direct</span><span class="hl-1">(</span><span class="hl-7">line</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-0">perform</span><span class="hl-1">(</span><span class="hl-7">line</span><span class="hl-1">: </span><span class="hl-6">string</span><span class="hl-1">, </span><span class="hl-7">loudness</span><span class="hl-1">: </span><span class="hl-6">number</span><span class="hl-1"> = </span><span class="hl-10">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-9">return</span><span class="hl-1"> </span><span class="hl-7">line</span><span class="hl-1"> + </span><span class="hl-2">&#39;!&#39;</span><span class="hl-1">.</span><span class="hl-0">repeat</span><span class="hl-1">(</span><span class="hl-7">loudness</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">container</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">ProxyDiContainer</span><span class="hl-1">();</span><br/><span class="hl-7">container</span><span class="hl-1">.</span><span class="hl-0">register</span><span class="hl-1">(</span><span class="hl-7">Actor</span><span class="hl-1">, </span><span class="hl-2">&#39;Actor&#39;</span><span class="hl-1">);</span><br/><span class="hl-7">container</span><span class="hl-1">.</span><span class="hl-0">register</span><span class="hl-1">(</span><span class="hl-7">Director</span><span class="hl-1">, </span><span class="hl-2">&#39;Director&#39;</span><span class="hl-1">);</span><br/><span class="hl-7">container</span><span class="hl-1">.</span><span class="hl-0">register</span><span class="hl-1">(</span><span class="hl-7">Agent007</span><span class="hl-1">, </span><span class="hl-2">&#39;Role&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">actor</span><span class="hl-1"> = </span><span class="hl-7">container</span><span class="hl-1">.</span><span class="hl-0">resolve</span><span class="hl-1">&lt;</span><span class="hl-6">Actor</span><span class="hl-1">&gt;(</span><span class="hl-2">&#39;Actor&#39;</span><span class="hl-1">);</span><br/><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-7">actor</span><span class="hl-1">.</span><span class="hl-0">play</span><span class="hl-1">());</span>
</code><button type="button">Copy</button></pre>

<pre><code class="shell"><span class="hl-1">&gt; Bond... James Bond!</span>
</code><button type="button">Copy</button></pre>

<p>In traditional DI containers, this scene would be tricky to shoot - the Director calls Actor's methods while Actor simultaneously needs Director's guidance.</p>
<p>But take a look, our approach is still the same - we just link dependencies by @inject and use them freely without any worries. ProxyDi handles this tricky issue as elegantly as is even possible. It does this using JavaScript Proxies, more about Proxies and theirs impact on perfomance <a href="#injection-proxy-performance">later</a>.</p>
<a id="hierarchy-of-containers" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Hierarchy of containers<a href="#hierarchy-of-containers" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Another tricky part of DI containers is the ability to create multiple instances of the same class. ProxyDi solves this problem in the simplest way possible - it just does not allow it. When you register a class as a dependency, there is only one instance of this class in the container.</p>
<p>Instead, it suggests you to use a hierarchy of containers by using <a href="https://proxy-di.github.io/proxydi/classes/ProxyDiContainer.html#createchildcontainer">createChildContainer()</a> method. Child container inherits all parent settings and can resolve exactly the same dependencies as their parent (but parent container does not have access to dependencies registered in its children).</p>
<p>For example, imagine you are working on a game level, there are many characters on this level, each character could have many perks.</p>
<p>With ProxyDi we can present all these stuff in a hierarchy of containers. The most top container holds information about game level, the most bottom ones hold information about perks:</p>
<pre><code class="typescript"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">tutorialContainer</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">ProxyDiContainer</span><span class="hl-1">();</span><br/><span class="hl-7">tutorialContainer</span><span class="hl-1">.</span><span class="hl-0">register</span><span class="hl-1">(</span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">GameLevel</span><span class="hl-1">({ </span><span class="hl-7">undewater:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1"> }), </span><span class="hl-2">&#39;level&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">heroContainer</span><span class="hl-1"> = </span><span class="hl-7">tutorialContainer</span><span class="hl-1">.</span><span class="hl-0">createChildContainer</span><span class="hl-1">();</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">hero</span><span class="hl-1"> = </span><span class="hl-7">heroContainer</span><span class="hl-1">.</span><span class="hl-0">register</span><span class="hl-1">&lt;</span><span class="hl-6">Character</span><span class="hl-1">&gt;(</span><span class="hl-7">Character</span><span class="hl-1">, </span><span class="hl-2">&#39;character&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">perksContainer</span><span class="hl-1"> = </span><span class="hl-7">heroContainer</span><span class="hl-1">.</span><span class="hl-0">createChildContainer</span><span class="hl-1">();</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">perk</span><span class="hl-1"> = </span><span class="hl-7">perksContainer</span><span class="hl-1">.</span><span class="hl-0">register</span><span class="hl-1">(</span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">UnderwaterShield</span><span class="hl-1">(</span><span class="hl-10">10</span><span class="hl-1">), </span><span class="hl-2">&#39;perk&#39;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>This is not how I propose to design games, ECS pattern does it better, but the goal was to demonstrate that with this approach instead of creating bunches of instances to represent your project entities, you can create bunches of containers each of them containing instances related to each other.</p>
<p>As a bonus, each bottom level dependency is free to use any dependency from the top:</p>
<pre><code class="typescript"><span class="hl-5">class</span><span class="hl-1"> </span><span class="hl-6">UnderwaterShield</span><span class="hl-1"> {</span><br/><span class="hl-1">    @</span><span class="hl-0">inject</span><span class="hl-1">(</span><span class="hl-2">&#39;level&#39;</span><span class="hl-1">) </span><span class="hl-5">private</span><span class="hl-1"> </span><span class="hl-7">level</span><span class="hl-1">: </span><span class="hl-6">GameLevel</span><span class="hl-1">;</span><br/><span class="hl-1">    @</span><span class="hl-0">inject</span><span class="hl-1">(</span><span class="hl-2">&#39;character&#39;</span><span class="hl-1">) </span><span class="hl-5">private</span><span class="hl-1"> </span><span class="hl-7">character</span><span class="hl-1">: </span><span class="hl-6">Character</span><span class="hl-1">;</span><br/><br/><span class="hl-1">    </span><span class="hl-5">constructor</span><span class="hl-1">(</span><span class="hl-5">private</span><span class="hl-1"> </span><span class="hl-7">amount</span><span class="hl-1">: </span><span class="hl-6">number</span><span class="hl-1">) {}</span><br/><br/><span class="hl-1">    </span><span class="hl-0">initialize</span><span class="hl-1">() {</span><br/><span class="hl-1">        </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-7">character</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;hit&#39;</span><span class="hl-1">, </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-7">act</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-0">act</span><span class="hl-1"> = () </span><span class="hl-5">=&gt;</span><br/><span class="hl-1">        </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-7">level</span><span class="hl-1">.</span><span class="hl-7">isUnderwater</span><span class="hl-1"> &amp;&amp; (</span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-7">character</span><span class="hl-1">.</span><span class="hl-7">health</span><span class="hl-1"> += </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-7">amount</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="rewriting-dependencies" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Rewriting dependencies<a href="#rewriting-dependencies" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>By default, ProxyDi doesn't allow rewriting dependencies in the container. After a dependency becomes known to the container, any attempt to register a new dependency with the same dependency ID will throw an Error:</p>
<pre><code class="typescript"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">container</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">ProxyDiContainer</span><span class="hl-1">();</span><br/><span class="hl-7">container</span><span class="hl-1">.</span><span class="hl-0">register</span><span class="hl-1">(</span><span class="hl-7">Actor</span><span class="hl-1">, </span><span class="hl-2">&#39;Actor&#39;</span><span class="hl-1">);</span><br/><span class="hl-7">container</span><span class="hl-1">.</span><span class="hl-0">register</span><span class="hl-1">(</span><span class="hl-7">Actor</span><span class="hl-1">, </span><span class="hl-2">&#39;Actor&#39;</span><span class="hl-1">); </span><span class="hl-3">// !!! Error here</span>
</code><button type="button">Copy</button></pre>

<p>However, there is an option that allows you to do these kinds of things:</p>
<pre><code class="typescript"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">container</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">ProxyDiContainer</span><span class="hl-1">({ </span><span class="hl-7">allowRewriteDependencies:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1"> });</span><br/><span class="hl-7">container</span><span class="hl-1">.</span><span class="hl-0">register</span><span class="hl-1">(</span><span class="hl-7">Actor</span><span class="hl-1">, </span><span class="hl-2">&#39;Actor&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">actor</span><span class="hl-1"> = </span><span class="hl-7">container</span><span class="hl-1">.</span><span class="hl-0">resolve</span><span class="hl-1">&lt;</span><span class="hl-6">Actor</span><span class="hl-1">&gt;(</span><span class="hl-2">&#39;Actor&#39;</span><span class="hl-1">);</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">wrapper</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">ActorWrapper</span><span class="hl-1">(</span><span class="hl-7">actor</span><span class="hl-1">);</span><br/><br/><span class="hl-7">container</span><span class="hl-1">.</span><span class="hl-0">register</span><span class="hl-1">(</span><span class="hl-7">wrapper</span><span class="hl-1">, </span><span class="hl-2">&#39;Actor&#39;</span><span class="hl-1">); </span><span class="hl-3">// No error is thrown here now</span>
</code><button type="button">Copy</button></pre>

<a id="injection-proxy-performance" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Injection proxy performance<a href="#injection-proxy-performance" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>As mentioned before, ProxyDi uses <code>Proxy</code> for each field marked by the @inject() decorator. This makes it possible to resolve circular dependencies. By default, these proxies are replaced by the actual dependency instances from the container during their first use, so the performance impact on your application is minimal.</p>
<p>However, if you allow rewriting dependencies in the container, these proxies remain in use to keep injections updated. As a result, every time you access a dependency field, there is a significant performance impact. In our tests, property access via Proxy is up to 100 times slower. For this reason, we recommend not allowing rewriting dependencies in production and keeping the container’s default behavior.</p>
<a id="baking-injections" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Baking injections<a href="#baking-injections" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>There is a container method <a href="https://proxy-di.github.io/proxydi/classes/ProxyDiContainer.html#bakeinjections">bakeInjections()</a> that bakes all injections and freezes the current container’s dependencies. After calling this method, the container restores behaviour by default and denies any attempts to rewrite dependencies. It also bakes the dependencies in all its children.</p>
<p>Therefore, after the container has been baked, the performance impact becomes zero. So, you could use this method even for containers with default settings, ensuring that your application doesn't have to wait for the first use of each injection before they are baked.</p>
<p>To be continued...</p>
<a id="license" class="tsd-anchor"></a><h2 class="tsd-anchor-link">License<a href="#license" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This project is licensed under the terms of the MIT License. See the <a href="media/LICENSE">LICENSE</a> file for details.</p>
<a id="contributing" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Contributing<a href="#contributing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Contribution documentation is not ready yet but is planned. Feel free to contribute even now though! :)</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#proxydi"><span>Proxy<wbr/>Di</span></a><ul><li><a href="#quick-start"><span>Quick start</span></a></li><li><ul><li><a href="#configure-typescript"><span>Configure <wbr/>Type<wbr/>Script</span></a></li><li><a href="#configure-babel"><span>Configure <wbr/>Babel</span></a></li><li><a href="#usage"><span>Usage</span></a></li></ul></li><li><a href="#the-reason"><span>The <wbr/>Reason</span></a></li><li><a href="#circular-dependencies"><span>Circular dependencies</span></a></li><li><a href="#hierarchy-of-containers"><span>Hierarchy of containers</span></a></li><li><a href="#rewriting-dependencies"><span>Rewriting dependencies</span></a></li><li><ul><li><a href="#injection-proxy-performance"><span>Injection proxy performance</span></a></li><li><a href="#baking-injections"><span>Baking injections</span></a></li></ul></li><li><a href="#license"><span>License</span></a></li><li><a href="#contributing"><span>Contributing</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html">proxydi</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
